apiVersion: apps/v1
kind: Deployment
metadata:
  name: '{{ .Release.Name }}-producer'
  labels:
    component: producer
    project: '{{ .Chart.Name }}'
    release: '{{ .Release.Name }}'
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "4"
spec:
  replicas: {{ .Values.knightcrawler.producer.replicas }}
  selector:
    matchLabels:
      component: producer
      release: '{{ .Release.Name }}'
  template:
    metadata:
      labels:
        component: producer
        release: '{{ .Release.Name }}'
    spec:
      containers:
        - name: producer
          image: '{{ .Values.knightcrawler.producer.image }}{{ if ne .Values.knightcrawler.globalImageTagOverride "" }}:{{ .Values.knightcrawler.globalImageTagOverride }}{{else}}:{{ .Values.knightcrawler.producer.tag}}{{ end }}'
          envFrom:
            - configMapRef:
                name: '{{ .Release.Name }}-config'
            - secretRef:
                name: '{{ .Release.Name }}-secrets'